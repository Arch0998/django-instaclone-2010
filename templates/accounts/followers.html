{% extends 'base.html' %}

{% block title %}Followers {{ profile_user.username }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-8 mx-auto">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3>Followers {{ profile_user.username }} ({{ count }})</h3>
                <a href="{% url 'accounts:profile' username=profile_user.username %}" class="btn btn-outline-secondary">
                    Back to profile
                </a>
            </div>

            {% if followers %}
                <div class="user-list">
                    {% for follow in followers %}
                        <div class="card mb-3">
                            <div class="card-body d-flex align-items-center">
                                <div class="user-avatar mr-3">
                                    {% if follow.follower.profile.avatar %}
                                        <img src="{{ follow.follower.profile.avatar.url }}" alt="{{ follow.follower.username }}" class="rounded-circle" width="50">
                                    {% else %}
                                        <div class="default-avatar rounded-circle" style="width: 50px; height: 50px;"></div>
                                    {% endif %}
                                </div>
                                <div class="user-info flex-grow-1">
                                    <a href="{% url 'accounts:profile' username=follow.follower.username %}" class="user-link">
                                        <h5 class="card-title mb-0">{{ follow.follower.username }}</h5>
                                    </a>
                                    {% if follow.follower.first_name or follow.follower.last_name %}
                                        <p class="card-text text-muted">{{ follow.follower.first_name }} {{ follow.follower.last_name }}</p>
                                    {% endif %}
                                </div>
                                {% if user != follow.follower %}
                                    <button class="btn btn-sm btn-primary follow-btn"
                                            data-username="{{ follow.follower.username }}">
                                        Follow
                                    </button>
                                {% endif %}
                            </div>
                        </div>
                    {% endfor %}
                </div>

                {% include "pagination.html" with page=page_obj %}
            {% else %}
                <div class="alert alert-info">
                    The user has no followers.
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    $(document).ready(function() {
        $('.follow-btn').click(function() {
            const username = $(this).data('username');
            const btn = $(this);

            $.ajax({
                url: `/user/${username}/follow/`,
                type: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                success: function(data) {
                    if (data.is_following) {
                        btn.text('Unfollow');
                    } else {
                        btn.text('Follow');
                    }
                }
            });
        });
    });
</script>
{% endblock %}
